<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>How to `filter` without `is` in Typescript? the `flatMap` as `filter` technique - YCM Jason</title><meta name="gridsome:hash" content="7d9a8c3a894efa7839367829d7b87bcf307b4dac"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.20"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="Jason loves solving problems. And he plays music."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.fc1e89df36d8722b28a19d261954e6a2.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.fc1e89df36d8722b28a19d261954e6a2.png"><link rel="preload" href="/assets/css/0.styles.11dff2c8.css" as="style"><link rel="preload" href="/assets/js/app.22554d26.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--dev-to-post-vue.976d812a.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.fb98ead7.js"><link rel="prefetch" href="/assets/js/page--src--pages--articles-vue.8df06748.js"><link rel="prefetch" href="/assets/js/page--src--pages--cv-vue.750e894a.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.e416752a.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--articles-vue.6fb927a9.js"><link rel="stylesheet" href="/assets/css/0.styles.11dff2c8.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><a href="https://github.com/ycmjason/ycmjason.com" aria-label="View source on GitHub" class="github-corner" data-v-03ac3be2><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" data-v-03ac3be2><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" data-v-03ac3be2></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" class="octo-arm" style="transform-origin: 130px 106px;" data-v-03ac3be2></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body" data-v-03ac3be2></path></svg></a><header class="header"><strong class="site-name">YCM Jason</strong><nav class="nav"><a href="/" class="nav__link active">Home</a><a href="/articles/" class="nav__link">Articles</a><a href="/cv/" class="nav__link">CV</a><a href="https://github.com/ycmjason" target="_blank" rel="noopener" class="nav__link">Github</a></nav></header><div class="markdown-body"><h1>How to `filter` without `is` in Typescript? the `flatMap` as `filter` technique</h1><div><p>Typescript gives developers confidence in their code changes. The types help developers understand code better, refactor code easier etc. However, one of the pain points of typescript is the <code>is</code> keyword.</p>
<h2 id="what-is-is"><a class="header-anchor" href="#what-is-is">#</a> What is <code>is</code>?</h2>
<p><code>is</code> is called a <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-guards-and-differentiating-types" target="_blank" rel="noopener noreferrer">type guard<OutboundLink/></a> in Typescript. It hints typescript about the type of an argument of a <em>type predicate</em>.</p>
<!--beforebegin--><div class="language-ts extra-class"><!--afterbegin--><pre v-pre class="language-ts"><code><span class="token keyword">const</span> isPen <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> x <span class="token keyword">is</span> Pen <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token keyword">instanceof</span> <span class="token class-name">Pen</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> p<span class="token operator">:</span> Pen <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token function">getPen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPen</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// typescript knows that `p` is `Pen`</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// typescript knows that `p` is `undefined | null`</span>
<span class="token punctuation">}</span>
</code></pre>
<!--beforeend--></div><!--afterend--><p>You can see this in <a href="https://www.typescriptlang.org/play/?ssl=1&amp;ssc=1&amp;pln=17&amp;pc=2#code/CYUwxgNghgTiAEkoGdnwAogHbwN7wF8AoUJOeAMwFcswAXASwHscBzEOzLACgEoAuDNngAfeDVAUGWEMFHwsVCBCKqwLZHXgNkXeAF543AB6CoWAJ4D4x7Wj36AfHiLx4cOlRg5b0zebAQJgohLCJiInUsTXgAB0E9MQkQKRk5MUVlA3h2Tmw+VQYQ7h0ubljeXhc3AHoa+DoLWJBkMBgGWK0AaywmAHc0OgALKC0AA1ixu3gxrjHXOPD4EAhkBFwFuoamlraO7t6BhpHxyemx5NTZeUyIebdY8KA" target="_blank" rel="noopener noreferrer">typescript playground<OutboundLink/></a>. You can hover on the variables to see how the type narrows down in the if statements.</p>
<p>Using this with <code>filter</code> we can filter a list of <code>Pen | undefined | null</code> to a list of <code>Pen</code>.</p>
<!--beforebegin--><div class="language-ts extra-class"><!--afterbegin--><pre v-pre class="language-ts"><code><span class="token keyword">const</span> ps<span class="token operator">:</span> <span class="token punctuation">(</span>Pen <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getPens</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> pens <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isPen<span class="token punctuation">)</span> <span class="token comment">// typescript knows that `pens` is `Pen[]`</span>
</code></pre>
<!--beforeend--></div><!--afterend--><p>However, the problem with this pattern is that Typescript does not care if the implementation of a type guard is correct.</p>
<!--beforebegin--><div class="language-ts extra-class"><!--afterbegin--><pre v-pre class="language-ts"><code><span class="token keyword">const</span> isPen <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> x <span class="token keyword">is</span> Pen <span class="token operator">=></span> <span class="token boolean">true</span>
</code></pre>
<!--beforeend--></div><!--afterend--><p>In this case, <code>isPen</code> is obviously wrong, but typescript will still assume that <code>x</code> will be <code>Pen</code> if <code>isPen</code> returns true. This does not give developers good confidence about the types.</p>
<p>This is why I try to avoid <code>is</code> where possible.</p>
<h2 id="flatmap-as-filter"><a class="header-anchor" href="#flatmap-as-filter">#</a> <code>flatMap</code> as <code>filter</code></h2>
<p>In most cases, we can avoid <code>is</code> by explicitly using <code>instanceof</code> or <code>!</code>. In the first example, we can just do:</p>
<!--beforebegin--><div class="language-ts extra-class"><!--afterbegin--><pre v-pre class="language-ts"><code><span class="token keyword">const</span> p<span class="token operator">:</span> Pen <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token function">getPen</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">Pen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// typescript knows that `p` is `Pen`</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// typescript knows that `p` is `undefined | null`</span>
<span class="token punctuation">}</span>

<span class="token comment">// or </span>


<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// typescript knows that `p` is `Pen`</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// typescript knows that `p` is `undefined | null`</span>
<span class="token punctuation">}</span>
</code></pre>
<!--beforeend--></div><!--afterend--><p>However, when using <code>filter</code>, <code>is</code> is basically inevitable.</p>
<p>I have therefore come up with this technique of using <code>flatMap</code> as <code>filter</code>.</p>
<!--beforebegin--><div class="language-ts extra-class"><!--afterbegin--><pre v-pre class="language-ts"><code><span class="token keyword">const</span> ps<span class="token operator">:</span> <span class="token punctuation">(</span>Pen <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getPens</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pens <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>p <span class="token operator">=></span> <span class="token operator">!</span>p <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// typescript knows that `pens` is `Pen[]`</span>
</code></pre>
<!--beforeend--></div><!--afterend--><p>Since typescript can infer the <code>p =&gt; !p ? [] : [p]</code> as <code>Pen | undefined | null =&gt; Pen</code>, the resulting array will be <code>Pen[]</code>.</p>
<p>With this technique, we are relying on typescript's type inference instead of manual type guarding (<code>is</code>) to filter the list. This gives developers much more confidence about the type. I personally also think that it is worth the extra noise added to the code for the type safety. (Let me know in comments if you don't!)</p>
<p>If you are confused about how <code>flatMap</code> works, you can read the following short introduction on <code>flatMap</code>.</p>
<h2 id="what-is-flatmap"><a class="header-anchor" href="#what-is-flatmap">#</a> What is <code>flatMap</code>?</h2>
<p><code>flatMap</code> can basically be defined as (roughly):</p>
<!--beforebegin--><div class="language-ts extra-class"><!--afterbegin--><pre v-pre class="language-ts"><code><span class="token keyword">const</span> flatMap <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">X</span><span class="token punctuation">,</span> <span class="token constant">Y</span><span class="token operator">></span><span class="token punctuation">(</span>xs<span class="token operator">:</span> <span class="token constant">X</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token constant">X</span> <span class="token operator">=></span> <span class="token constant">Y</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">Y</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<!--beforeend--></div><!--afterend--><p>In English, it maps each item <code>x</code> of <code>xs</code> into an array <code>ys</code> and flattens it.</p>
<p>Below is a illustration of how <code>flatMap</code> works</p>
<!--beforebegin--><div class="language- extra-class"><!--afterbegin--><pre v-pre class="language-text"><code>[1, 2, 3].flatMap(x =&gt; [x, x, x])

// under the hood
[1, 2, 3]
⬇
⬇ .map(x =&gt; [x, x, x])
⬇
[[1, 1, 1], [2, 2, 2], [3, 3, 3]]
⬇
⬇ .flat()
⬇
[1, 1, 1, 2, 2, 2, 3, 3, 3]
</code></pre>
<!--beforeend--></div><!--afterend--><h2 id="conclusion"><a class="header-anchor" href="#conclusion">#</a> Conclusion</h2>
<p>Type safety is the reason why we went for Typescript. So, using <code>is</code> and <code>as</code> feels like it kind of defeats the purpose. Typescript's type system help catch many problems. But <code>is</code> and <code>as</code> bypasses that and make problems undetectable. By avoiding <code>is</code> and <code>as</code>, developers will have more confidence in their code.</p>
<p>What do you think about this technique? Let me know in the comments!</p>
</div></div><footer>Copyright © 2020 Jason Yu</footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"How to `filter` without `is` in Typescript? the `flatMap` as `filter` technique","content":"\u003Cp\u003ETypescript gives developers confidence in their code changes. The types help developers understand code better, refactor code easier etc. However, one of the pain points of typescript is the \u003Ccode\u003Eis\u003C\u002Fcode\u003E keyword.\u003C\u002Fp\u003E\n\u003Ch2 id=\"what-is-is\"\u003E\u003Ca class=\"header-anchor\" href=\"#what-is-is\"\u003E#\u003C\u002Fa\u003E What is \u003Ccode\u003Eis\u003C\u002Fcode\u003E?\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Ccode\u003Eis\u003C\u002Fcode\u003E is called a \u003Ca href=\"https:\u002F\u002Fwww.typescriptlang.org\u002Fdocs\u002Fhandbook\u002Fadvanced-types.html#type-guards-and-differentiating-types\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Etype guard\u003COutboundLink\u002F\u003E\u003C\u002Fa\u003E in Typescript. It hints typescript about the type of an argument of a \u003Cem\u003Etype predicate\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language-ts extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-ts\"\u003E\u003Ccode\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E isPen \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eany\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E x \u003Cspan class=\"token keyword\"\u003Eis\u003C\u002Fspan\u003E Pen \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E x \u003Cspan class=\"token keyword\"\u003Einstanceof\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EPen\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E p\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E Pen \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enull\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EgetPen\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EisPen\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ep\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `p` is `Pen`\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `p` is `undefined | null`\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Cp\u003EYou can see this in \u003Ca href=\"https:\u002F\u002Fwww.typescriptlang.org\u002Fplay\u002F?ssl=1&amp;ssc=1&amp;pln=17&amp;pc=2#code\u002FCYUwxgNghgTiAEkoGdnwAogHbwN7wF8AoUJOeAMwFcswAXASwHscBzEOzLACgEoAuDNngAfeDVAUGWEMFHwsVCBCKqwLZHXgNkXeAF543AB6CoWAJ4D4x7Wj36AfHiLx4cOlRg5b0zebAQJgohLCJiInUsTXgAB0E9MQkQKRk5MUVlA3h2Tmw+VQYQ7h0ubljeXhc3AHoa+DoLWJBkMBgGWK0AaywmAHc0OgALKC0AA1ixu3gxrjHXOPD4EAhkBFwFuoamlraO7t6BhpHxyemx5NTZeUyIebdY8KA\" target=\"_blank\" rel=\"noopener noreferrer\"\u003Etypescript playground\u003COutboundLink\u002F\u003E\u003C\u002Fa\u003E. You can hover on the variables to see how the type narrows down in the if statements.\u003C\u002Fp\u003E\n\u003Cp\u003EUsing this with \u003Ccode\u003Efilter\u003C\u002Fcode\u003E we can filter a list of \u003Ccode\u003EPen | undefined | null\u003C\u002Fcode\u003E to a list of \u003Ccode\u003EPen\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language-ts extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-ts\"\u003E\u003Ccode\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E ps\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EPen \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EgetPens\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E pens \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E ps\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Efilter\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EisPen\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `pens` is `Pen[]`\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Cp\u003EHowever, the problem with this pattern is that Typescript does not care if the implementation of a type guard is correct.\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language-ts extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-ts\"\u003E\u003Ccode\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E isPen \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token builtin\"\u003Eany\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E x \u003Cspan class=\"token keyword\"\u003Eis\u003C\u002Fspan\u003E Pen \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Etrue\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Cp\u003EIn this case, \u003Ccode\u003EisPen\u003C\u002Fcode\u003E is obviously wrong, but typescript will still assume that \u003Ccode\u003Ex\u003C\u002Fcode\u003E will be \u003Ccode\u003EPen\u003C\u002Fcode\u003E if \u003Ccode\u003EisPen\u003C\u002Fcode\u003E returns true. This does not give developers good confidence about the types.\u003C\u002Fp\u003E\n\u003Cp\u003EThis is why I try to avoid \u003Ccode\u003Eis\u003C\u002Fcode\u003E where possible.\u003C\u002Fp\u003E\n\u003Ch2 id=\"flatmap-as-filter\"\u003E\u003Ca class=\"header-anchor\" href=\"#flatmap-as-filter\"\u003E#\u003C\u002Fa\u003E \u003Ccode\u003EflatMap\u003C\u002Fcode\u003E as \u003Ccode\u003Efilter\u003C\u002Fcode\u003E\u003C\u002Fh2\u003E\n\u003Cp\u003EIn most cases, we can avoid \u003Ccode\u003Eis\u003C\u002Fcode\u003E by explicitly using \u003Ccode\u003Einstanceof\u003C\u002Fcode\u003E or \u003Ccode\u003E!\u003C\u002Fcode\u003E. In the first example, we can just do:\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language-ts extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-ts\"\u003E\u003Ccode\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E p\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E Pen \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enull\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EgetPen\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ep \u003Cspan class=\"token keyword\"\u003Einstanceof\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EPen\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `p` is `Pen`\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `p` is `undefined | null`\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F or \u003C\u002Fspan\u003E\n\n\n\u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E!\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E!\u003C\u002Fspan\u003Ep\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `p` is `Pen`\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `p` is `undefined | null`\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Cp\u003EHowever, when using \u003Ccode\u003Efilter\u003C\u002Fcode\u003E, \u003Ccode\u003Eis\u003C\u002Fcode\u003E is basically inevitable.\u003C\u002Fp\u003E\n\u003Cp\u003EI have therefore come up with this technique of using \u003Ccode\u003EflatMap\u003C\u002Fcode\u003E as \u003Ccode\u003Efilter\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language-ts extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-ts\"\u003E\u003Ccode\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E ps\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EPen \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Eundefined\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E|\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003EgetPens\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E pens \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E ps\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003EflatMap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Ep \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E!\u003C\u002Fspan\u003Ep \u003Cspan class=\"token operator\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003Ep\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F typescript knows that `pens` is `Pen[]`\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Cp\u003ESince typescript can infer the \u003Ccode\u003Ep =&gt; !p ? [] : [p]\u003C\u002Fcode\u003E as \u003Ccode\u003EPen | undefined | null =&gt; Pen\u003C\u002Fcode\u003E, the resulting array will be \u003Ccode\u003EPen[]\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EWith this technique, we are relying on typescript's type inference instead of manual type guarding (\u003Ccode\u003Eis\u003C\u002Fcode\u003E) to filter the list. This gives developers much more confidence about the type. I personally also think that it is worth the extra noise added to the code for the type safety. (Let me know in comments if you don't!)\u003C\u002Fp\u003E\n\u003Cp\u003EIf you are confused about how \u003Ccode\u003EflatMap\u003C\u002Fcode\u003E works, you can read the following short introduction on \u003Ccode\u003EflatMap\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Ch2 id=\"what-is-flatmap\"\u003E\u003Ca class=\"header-anchor\" href=\"#what-is-flatmap\"\u003E#\u003C\u002Fa\u003E What is \u003Ccode\u003EflatMap\u003C\u002Fcode\u003E?\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Ccode\u003EflatMap\u003C\u002Fcode\u003E can basically be defined as (roughly):\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language-ts extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-ts\"\u003E\u003Ccode\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E flatMap \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token constant\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token constant\"\u003EY\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Exs\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token constant\"\u003EX\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token function-variable function\"\u003Efn\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token constant\"\u003EX\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token constant\"\u003EY\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token constant\"\u003EY\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E xs\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Efn\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token function\"\u003Eflat\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Cp\u003EIn English, it maps each item \u003Ccode\u003Ex\u003C\u002Fcode\u003E of \u003Ccode\u003Exs\u003C\u002Fcode\u003E into an array \u003Ccode\u003Eys\u003C\u002Fcode\u003E and flattens it.\u003C\u002Fp\u003E\n\u003Cp\u003EBelow is a illustration of how \u003Ccode\u003EflatMap\u003C\u002Fcode\u003E works\u003C\u002Fp\u003E\n\u003C!--beforebegin--\u003E\u003Cdiv class=\"language- extra-class\"\u003E\u003C!--afterbegin--\u003E\u003Cpre v-pre class=\"language-text\"\u003E\u003Ccode\u003E[1, 2, 3].flatMap(x =&gt; [x, x, x])\n\n\u002F\u002F under the hood\n[1, 2, 3]\n⬇\n⬇ .map(x =&gt; [x, x, x])\n⬇\n[[1, 1, 1], [2, 2, 2], [3, 3, 3]]\n⬇\n⬇ .flat()\n⬇\n[1, 1, 1, 2, 2, 2, 3, 3, 3]\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003C!--beforeend--\u003E\u003C\u002Fdiv\u003E\u003C!--afterend--\u003E\u003Ch2 id=\"conclusion\"\u003E\u003Ca class=\"header-anchor\" href=\"#conclusion\"\u003E#\u003C\u002Fa\u003E Conclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EType safety is the reason why we went for Typescript. So, using \u003Ccode\u003Eis\u003C\u002Fcode\u003E and \u003Ccode\u003Eas\u003C\u002Fcode\u003E feels like it kind of defeats the purpose. Typescript's type system help catch many problems. But \u003Ccode\u003Eis\u003C\u002Fcode\u003E and \u003Ccode\u003Eas\u003C\u002Fcode\u003E bypasses that and make problems undetectable. By avoiding \u003Ccode\u003Eis\u003C\u002Fcode\u003E and \u003Ccode\u003Eas\u003C\u002Fcode\u003E, developers will have more confidence in their code.\u003C\u002Fp\u003E\n\u003Cp\u003EWhat do you think about this technique? Let me know in the comments!\u003C\u002Fp\u003E\n"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.22554d26.js" defer></script><script src="/assets/js/page--src--templates--dev-to-post-vue.976d812a.js" defer></script>
  </body>
</html>
